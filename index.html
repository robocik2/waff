<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: #2c3e50;
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .turntable {
      position: relative;
      width: 300px;
      height: 300px;
      background: #34495e;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      cursor: grab;
    }

    .turntable:active {
      cursor: grabbing;
    }

    .vinyl {
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      background: #2c3e50;
      border-radius: 50%;
      animation: spin 4s linear infinite;
    }

    .vinyl::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 10%;
      height: 10%;
      background: #95a5a6;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .grooves {
      position: absolute;
      top: 15%;
      left: 15%;
      width: 70%;
      height: 70%;
      border-radius: 50%;
      border: 1px solid #95a5a6;
      pointer-events: none;
    }

    .grooves::before {
      content: '';
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      border-radius: 50%;
      border: 1px solid #95a5a6;
    }

    .grooves::after {
      content: '';
      position: absolute;
      top: 20%;
      left: 20%;
      width: 60%;
      height: 60%;
      border-radius: 50%;
      border: 1px solid #95a5a6;
    }

    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    button {
      padding: 10px 20px;
      background: #3498db;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #2980b9;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .paused {
      animation-play-state: paused;
    }
  </style>
</head>
<body>
  <div class="turntable">
    <div class="vinyl">
      <div class="grooves"></div>
    </div>
  </div>
  <div class="controls">
    <button onclick="changeTrack(1)">Track 1</button>
    <button onclick="changeTrack(2)">Track 2</button>
    <button onclick="changeTrack(3)">Track 3</button>
  </div>

  <script>
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let oscillators = null;
    let gainNode = null;
    let filterNode = null;

    function createSynth() {
      // Create nodes
      const osc1 = audioContext.createOscillator();
      const osc2 = audioContext.createOscillator();
      const osc3 = audioContext.createOscillator();
      gainNode = audioContext.createGain();
      filterNode = audioContext.createBiquadFilter();
      const subGain = audioContext.createGain();
      
      // Set oscillator types
      osc1.type = 'sawtooth';
      osc2.type = 'square';
      osc3.type = 'sine';
      
      // Connect nodes
      osc1.connect(gainNode);
      osc2.connect(subGain);
      osc3.connect(subGain);
      subGain.connect(gainNode);
      gainNode.connect(filterNode);
      filterNode.connect(audioContext.destination);
      
      // Set initial values
      gainNode.gain.value = 0.15;
      subGain.gain.value = 0.1;
      filterNode.type = 'lowpass';
      filterNode.frequency.value = 1000;
      filterNode.Q.value = 1;
      
      // Start oscillators
      osc1.start();
      osc2.start();
      osc3.start();
      
      return [osc1, osc2, osc3];
    }

    const vinyl = document.querySelector('.vinyl');
    const turntable = document.querySelector('.turntable');
    let isDragging = false;
    let lastX = 0;
    let lastY = 0;
    let lastMoveTime = 0;
    let currentRotation = 0;
    let currentTrackFreq = 440;
    let velocityX = 0;
    let velocityY = 0;

    function updatePitch() {
      if (!isDragging || !oscillators) return;

      // Calculate velocity magnitude
      const velocity = Math.sqrt(velocityX * velocityX + velocityY * velocityY);
      const direction = velocityX > 0 ? 1 : -1;
      
      // Map velocity to pitch
      const pitchBend = velocity * direction * 0.01;
      const targetPitch = Math.max(0.01, 1 + pitchBend);
      
      // Update oscillator frequencies
      oscillators.forEach((osc, index) => {
        const detune = index * 5;
        osc.frequency.setTargetAtTime(
          (currentTrackFreq + detune) * targetPitch,
          audioContext.currentTime,
          0.02
        );
      });

      // Update filter based on velocity
      filterNode.frequency.setTargetAtTime(
        1000 + (velocity * 100),
        audioContext.currentTime,
        0.02
      );

      // Update gain based on velocity
      const targetGain = velocity < 0.1 ? 0.01 : 0.15;
      gainNode.gain.setTargetAtTime(targetGain, audioContext.currentTime, 0.02);

      // Update visual rotation
      currentRotation += velocityX;
      vinyl.style.transform = `rotate(${currentRotation}deg)`;

      // Decay velocities
      velocityX *= 0.95;
      velocityY *= 0.95;

      requestAnimationFrame(updatePitch);
    }

    function changeTrack(trackNum) {
      switch(trackNum) {
        case 1:
          currentTrackFreq = 440;
          break;
        case 2:
          currentTrackFreq = 523.25;
          break;
        case 3:
          currentTrackFreq = 659.25;
          break;
      }
      
      if (oscillators) {
        oscillators.forEach((osc, index) => {
          const detune = index * 5;
          osc.frequency.setValueAtTime(currentTrackFreq + detune, audioContext.currentTime);
        });
      }
    }

    turntable.addEventListener('mousedown', (e) => {
      if (!oscillators) {
        oscillators = createSynth();
      }
      
      isDragging = true;
      vinyl.classList.add('paused');
      lastX = e.clientX;
      lastY = e.clientY;
      lastMoveTime = performance.now();
      velocityX = 0;
      velocityY = 0;
      
      requestAnimationFrame(updatePitch);
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        const currentTime = performance.now();
        const deltaTime = (currentTime - lastMoveTime) / 1000; // Convert to seconds
        
        // Calculate velocities
        velocityX = (e.clientX - lastX) / deltaTime;
        velocityY = (e.clientY - lastY) / deltaTime;
        
        // Normalize velocities
        const maxVelocity = 1000;
        velocityX = Math.max(-maxVelocity, Math.min(maxVelocity, velocityX));
        velocityY = Math.max(-maxVelocity, Math.min(maxVelocity, velocityY));
        
        lastX = e.clientX;
        lastY = e.clientY;
        lastMoveTime = currentTime;
      }
    });

    document.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        vinyl.classList.remove('paused');
        vinyl.style.transform = '';
        
        // Reset audio to normal
        oscillators.forEach((osc, index) => {
          const detune = index * 5;
          osc.frequency.setTargetAtTime(currentTrackFreq + detune, audioContext.currentTime, 0.1);
        });
        gainNode.gain.setTargetAtTime(0.15, audioContext.currentTime, 0.1);
        filterNode.frequency.setTargetAtTime(1000, audioContext.currentTime, 0.1);
      }
    });

    document.body.addEventListener('click', () => {
      if (!oscillators) oscillators = createSynth();
    }, { once: true });
  </script>
</body>
</html>
